<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Check</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="gcov2html-check"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Autotools"
HREF="auto.html"><LINK
REL="NEXT"
TITLE="Adding Tests"
HREF="chk-test.html"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>gcov2html-check</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="auto.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="chk-test.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="CHK"
></A
>Chapter 6. Check</H1
><P
>Quoting from the <A
HREF="http://check.sourceforge.net"
TARGET="_top"
>website</A
>:
  <A
NAME="AEN196"
></A
><BLOCKQUOTE
CLASS="BLOCKQUOTE"
><P
><TT
CLASS="LITERAL"
>Check</TT
> is a unit testing framework for C.
It features a simple interface for defining unit tests, putting little in the way of the developer.
Tests are run in a separate address space, so <TT
CLASS="LITERAL"
>Check</TT
> can catch both assertion failures
and code errors that cause segmentation faults or other signals.
  </P
></BLOCKQUOTE
>
 </P
><P
>The <TT
CLASS="LITERAL"
>Makefile</TT
> which is generated by the <TT
CLASS="LITERAL"
>autotools</TT
> provides a "<TT
CLASS="LITERAL"
>make check</TT
>"
target which causes the build system to compile and run programs/scripts you write to test your
main application code. You usually don't install <TT
CLASS="LITERAL"
>check</TT
> targets and you don't
usually run your tests implicitly with the <TT
CLASS="LITERAL"
>all</TT
> target.
 </P
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CHK-PREP"
>6.1. Preparation</A
></H1
><P
>Since the applications which perform the tests are free-standing executables on their own, they
need to have a <TT
CLASS="LITERAL"
>main()</TT
>. This means you need to separate out your code such
that your application's <TT
CLASS="LITERAL"
>main()</TT
> is in its own compilation unit. Now that
your <TT
CLASS="LITERAL"
>main()</TT
> is in one file and the rest of your application is in one or
more files, you can write a test program to exercise your code.
 </P
><P
>Using the bubble sort code from above as an example I would start by renaming
its <TT
CLASS="LITERAL"
>main()</TT
> to, say, <TT
CLASS="LITERAL"
>bsort_main()</TT
>:
  <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>   &nbsp;...
   &nbsp;static void print_array (int arr[], size_t sz);
   &nbsp;  
   &nbsp;int
  5&nbsp;bsort_main (void)
   &nbsp;{
   &nbsp;    int arr[ARRSZ];
   &nbsp;    unsigned swaps;
   &nbsp;...
 10&nbsp;  </PRE
></TD
></TR
></TABLE
>
 </P
><P
>...and then I would write a <TT
CLASS="FILENAME"
>main.c</TT
> to hold the application's
<TT
CLASS="LITERAL"
>main()</TT
>:
  <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>   &nbsp;/*
   &nbsp; * Copyright (C) 2011  Trevor Woerner
   &nbsp; */
   &nbsp;
  5&nbsp;#include &#60;stdio.h&#62;
   &nbsp;
   &nbsp;int bsort_main (void);
   &nbsp;
   &nbsp;int
 10&nbsp;main (void)
   &nbsp;{
   &nbsp;    return bsort_main ();
   &nbsp;}
   &nbsp;  </PRE
></TD
></TR
></TABLE
>
 </P
><P
>The <TT
CLASS="FILENAME"
>Makefile.am</TT
> would also have to be updated:
  <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>   &nbsp;## Copyright (C) 2011  Trevor Woerner
   &nbsp;
   &nbsp;########################
   &nbsp;## src/Makefile.am
  5&nbsp;########################
   &nbsp;SUBDIRS =
   &nbsp;bin_PROGRAMS = bsort gcov-bsort
   &nbsp;<B
CLASS="COMMAND"
>bsort_SOURCES = main.c bsort.c</B
>
   &nbsp;gcov_bsort_SOURCES = <B
CLASS="COMMAND"
>main.c</B
> bsort.c
 10&nbsp;gcov_bsort_CFLAGS = -fprofile-arcs -ftest-coverage
   &nbsp;
   &nbsp;clean-local:
   &nbsp;        $(RM) *gcno *gcda *gcov *html
   &nbsp;  </PRE
></TD
></TR
></TABLE
>
 </P
><P
>In my case I designated all of <TT
CLASS="FILENAME"
>bsort.c</TT
>'s "private" functions as static.
This won't work so well when I try to test them from a separate compilation unit. So in this
case I'll need to be able to get rid of the <TT
CLASS="LITERAL"
>static</TT
>-ness when compiling
together with the test code, and keep them <TT
CLASS="LITERAL"
>static</TT
> otherwise. My solution
relies on the test program's compile defining the <TT
CLASS="LITERAL"
>UNDER_TEST</TT
> symbol:
  <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>   &nbsp;#ifdef UNDER_TEST
   &nbsp;# define static
   &nbsp;#else
   &nbsp;# define static static
  5&nbsp;#endif // UNDER_TEST
   &nbsp;  </PRE
></TD
></TR
></TABLE
>
 </P
><P
>Additionally, since I will be calling the functions in <TT
CLASS="FILENAME"
>bsort.c</TT
>
from another file I'll need to know their names, types, parameter list, etc. So
to make it easy I create a header file:
  <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>   &nbsp;/*
   &nbsp; * Copyright (C) 2011  Trevor Woerner
   &nbsp; */
   &nbsp;
  5&nbsp;#ifndef BSORT__H
   &nbsp;#define BSORT__H
   &nbsp;
   &nbsp;#ifdef UNDER_TEST
   &nbsp;# define static
 10&nbsp;#else
   &nbsp;# define static static
   &nbsp;#endif // UNDER_TEST
   &nbsp;
   &nbsp;#define ARRSZ 32
 15&nbsp;
   &nbsp;static void randomize (int arr[], size_t sz);
   &nbsp;static unsigned bsort (int arr[], size_t sz);
   &nbsp;static void print_array (int arr[], size_t sz);
   &nbsp;
 20&nbsp;#endif // BSORT__H
   &nbsp;  </PRE
></TD
></TR
></TABLE
>
 </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="auto.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="chk-test.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Autotools</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Adding Tests</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>